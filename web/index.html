<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <title>MimaSim</title><!-- numbering the textarea -->

  <style type="text/css">
  /*<![CDATA[*/
    #editor{
    border:2px solid gray;position:relative;
    height:720px;width:400px;margin: 8px;
    }
    #log_text{
    border:0px solid gray;position:relative;
    height:720px;width:600px
    }
    #output_text{
    border:0px solid gray;position:relative;
    height:720px;width:600px;margin-left: 16px;
    }
  /*]]>*/
  </style>
  <link rel="stylesheet" type="text/css" href="./tln.css" />
  <script type="text/javascript" src="./tln.js"></script>
</head>
<body>
  <h1 style="text-align: center">WebAssembly Mima Simulator</h1>
  <p style="text-align: center"><a href="https://github.com/bnlrnz/MimaSim">https://github.com/bnlrnz/MimaSim</a></p>
  <div class="flex-container-v">
    <div class="flex-container">
      <div class="flex-container-v" style="margin: 8px">
        <div class="flex-container-v">
          <input class="button" type="button" id="btn_compile" value="Assemble" /> <input class="button" type="button" id="btn_reset" value="Reset" disabled="disabled" />
        </div>
        <div class="flex-container-v">
          <input class="button" type="button" id="btn_run" value="Run" disabled="disabled" /> <input class="button" type="button" id="btn_step" value="Step" disabled="disabled" /> <input class="button" type="button" id="btn_mstep" value="Micro Step" disabled="disabled" />
        </div>
      </div>
      <div id="editor">
        <textarea id="source_code">
// Fibonacci
0xFF0 1     // F0
0xFF1 1     // F1
0xFF2 0     // Fn
0xFF3 1     // 1
0xFFC 0     // Counter
0xFFD 10    // Limit + 2
LDV 0x0c000002  // ask for limit
STV 0xFFD       // save limit
LDV 0xFF0
STV 0x0c000004
STV 0x0c000004
:LOOP
LDV 0xFF0
ADD 0xFF1
STV 0xFF2
STV 0x0c000004  // Output Fn
LDV 0xFF1
STV 0xFF0
LDV 0xFF2
B             // Breakpoint
STV 0xFF1
LDV 0xFFC
ADD 0xFF3
STV 0xFFC
EQL 0xFFD
NOT
JMN LOOP
HLT</textarea>
      </div>
      <div>
        <object id="mimaimg" src="mima.min.svg" data="mima.min.svg" type="image/svg+xml" style="margin: 8px;">
        </object>
      </div>
    </div>
    <div class="flex-container" style="height:600px;width:100%;margin-top: 8px;">
      <div class="flex-container-v">
        <p>LOG</p>
        <div id="log_text" style="overflow: auto;border: 2px solid gray;" readonly="readonly"></div>
        <div>
          <form name="loglevel_radio_form" id="loglevel_radio_form">
            <fieldset id="loglevel_radio_field" style="border: 0px">
              <input type="radio" name="loglevel" id="ll_trace" value="TRACE" /><label for="ll_trace" style="margin-right: 16px">TRACE</label> <input type="radio" name="loglevel" id="ll_debug" value="DEBUG" /><label for="ll_debug" style="margin-right: 16px">DEBUG</label> <input type="radio" name="loglevel" id="ll_info" value="INFO" /><label for="ll_info" style="margin-right: 16px">INFO</label> <input type="radio" name="loglevel" id="ll_warn" value="WARN" /><label for="ll_warn" style="margin-right: 16px">WARN</label>
            </fieldset>
          </form>
        </div>
      </div>
      <div class="flex-container-v">
        <p style="margin-left: 16px">OUTPUT (0xC000003 (char) and 0xC000004 (int))</p>
        <div id="output_text" style="overflow: auto;border: 2px solid gray;" readonly="readonly"></div>
      </div>
    </div>
  </div>
  <script type="text/javascript">
    
    window.onload = function(){

      loadScripts();

      function loadScripts(){
        var scripts = [];
        var _scripts = ['MimaSim.js', 'MimaSimGUI.js']

        loadScriptsSync(_scripts, scripts);
      }

      function loadScriptsSync(_scripts, scripts){
        var x = 0;
        var loopArray = function(_scripts, scripts){
          loadScript(_scripts[x], scripts[x], function(){
            ++x;
            if( x < _scripts.length){
              loopArray(_scripts, scripts);
            }
          });
        }
        loopArray(_scripts, scripts)
      }

      function loadScript(src, script, callback){
        script = document.createElement('script');
        script.onerror = function() { 
            // handling error when loading script
            alert('Error to handle')
        }
        script.onload = function(){
            console.log(src + ' loaded ')
            callback();
        }
        script.src = src;
        document.getElementsByTagName('head')[0].appendChild(script);
      }
    }
  </script>
</body>
</html>
